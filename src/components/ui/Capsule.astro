---
import { getLanguage } from "../../utils/languages";

interface Props {
  lang: string;
  size?: "xs" | "md";
  linkEnabled?: boolean;
}

const { size = "md", lang, linkEnabled = true } = Astro.props as Props;

// Detect TikTok handles
const isTikTok = lang.startsWith("@");

// Detect custom labels (food, brands, emojis, locations)
const isCustomLabel = /[\süìç]/.test(lang);

// Detect if emoji already exists in label
const hasEmoji = /\p{Extended_Pictographic}/u.test(lang);

// ---------- Emoji Map ----------
const emojiMap: Record<string, string> = {
  "@healxyz": "üßòüèΩ‚Äç‚ôÇÔ∏è",
  "@luvnft": "üíú",
  "@deliv3ry": "üì¶",
  "@rntbnb": "üè°",
  "@twerksocial": "üíÉ",
  "@manifestppv": "üîÆ",
  "@rfptok": "üéØ",
  "@rwatok": "üèõÔ∏è",
  "@yenobet": "üé∞",
  "@foodcoins": "ü•ó",
  "@ugcreviews": "‚≠ê",
  "@lumeebooth": "üì∏",
  "@aipromptok": "ü§ñ",
  "@smilesats": "üòÅ",

  "Nothing Bundt Cakes": "üßÅ",
  "Wingstop": "üçó",
  "Milk & Honey": "üç§",
  "Breakfast at Barney's": "üç≥",
  "Shawn Food Reviews": "üé¨",
};

// Only prepend emoji if label DOES NOT already contain one
const emoji =
  hasEmoji
    ? null
    : emojiMap[lang] ||
      Object.entries(emojiMap).find(([key]) => lang.includes(key))?.[1] ||
      "üé¨";

// ---------- Base Classes ----------
const baseClasses = [
  "flex items-center gap-2",
  "px-4 py-2",
  "rounded-full",
  "bg-white/90 dark:bg-zinc-900/80",
  "text-zinc-900 dark:text-white",
  "border border-mint-400/60",
  "text-sm font-semibold",
  "transition-all duration-300",
  "hover:scale-105 hover:shadow-[0_0_20px_rgba(13,188,130,0.35)]",
].join(" ");

const sizeClasses = {
  xs: "text-xs px-3 py-1.5",
  md: "text-sm px-4 py-2",
};

// ---------- Label Resolution ----------
let label = lang;

// ONLY use getLanguage for real tech keywords (no spaces, no emojis)
if (!isTikTok && !isCustomLabel && !hasEmoji) {
  const tech = getLanguage(lang);
  if (tech?.name) label = tech.name;
}

const classes = `${baseClasses} ${sizeClasses[size]}`;
---

{linkEnabled ? (
  <a
    href={
      isTikTok
        ? `https://www.tiktok.com/${lang}`
        : isCustomLabel
        ? "#"
        : `/blog/techs/${lang}`
    }
    target={isTikTok ? "_blank" : undefined}
    rel={isTikTok ? "noopener noreferrer" : undefined}
    class={classes}
    aria-label={label}
  >
    {emoji && <span class="text-lg leading-none">{emoji}</span>}
    <span class="whitespace-nowrap">{label}</span>
  </a>
) : (
  <span class={`${classes} cursor-default`} aria-hidden="true">
    {emoji && <span class="text-lg leading-none">{emoji}</span>}
    <span class="whitespace-nowrap">{label}</span>
  </span>
)}