---
import { getLanguage } from "../../utils/languages";

interface Props {
  lang: string;
  size?: "xs" | "md";
  linkEnabled?: boolean;
}

const { size = "md", lang, linkEnabled = true } = Astro.props as Props;

// Detect TikTok handles
const isTikTok = lang.startsWith("@");

// Detect custom labels (food, brands, emojis, locations)
const isCustomLabel = /[\sğŸ“ğŸ”ğŸ—ğŸ³ğŸ¤ğŸ§ğŸ—£ï¸]/.test(lang);

// ---------- Emoji Map ----------
const emojiMap: Record<string, string> = {
  "@healxyz": "ğŸ§˜ğŸ½â€â™‚ï¸",
  "@luvnft": "ğŸ’œ",
  "@deliv3ry": "ğŸ“¦",
  "@rntbnb": "ğŸ¡",
  "@twerksocial": "ğŸ’ƒ",
  "@manifestppv": "ğŸ”®",
  "@rfptok": "ğŸ¯",
  "@rwatok": "ğŸ›ï¸",
  "@yenobet": "ğŸ°",
  "@foodcoins": "ğŸ¥—",
  "@ugcreviews": "â­",
  "@lumeebooth": "ğŸ“¸",
  "@aipromptok": "ğŸ¤–",
  "@smilesats": "ğŸ˜",

  "Nothing Bundt Cakes": "ğŸ§",
  "Wingstop": "ğŸ—",
  "Milk & Honey": "ğŸ¤",
  "Breakfast at Barney's": "ğŸ³",
};

const emoji =
  emojiMap[lang] ||
  Object.entries(emojiMap).find(([key]) => lang.includes(key))?.[1] ||
  "ğŸ¬";

// ---------- Base Classes ----------
const baseClasses = [
  "flex items-center gap-2",
  "px-3 py-1.5",
  "rounded-full",
  "bg-white dark:bg-zinc-800",
  "text-zinc-800 dark:text-white",
  "border border-mint-400",
  "text-sm font-semibold",
  "transition-all duration-300",
  "hover:scale-110 hover:shadow-[0_0_20px_rgba(13,188,130,0.3)]",
].join(" ");

const sizeClasses = {
  xs: "text-xs px-2 py-1",
  md: "text-sm px-3 py-1.5",
};

// ---------- Label Resolution ----------
let label = lang;

// ONLY use getLanguage for real tech keywords
if (!isTikTok && !isCustomLabel) {
  const tech = getLanguage(lang);
  if (tech?.name) label = tech.name;
}

const classes = `${baseClasses} ${sizeClasses[size]}`;
---

{linkEnabled ? (
  <a
    href={
      isTikTok
        ? `https://www.tiktok.com/${lang}`
        : isCustomLabel
        ? "#"
        : `/blog/techs/${lang}`
    }
    target={isTikTok ? "_blank" : undefined}
    rel={isTikTok ? "noopener noreferrer" : undefined}
    class={classes}
    aria-label={label}
  >
    <span class="text-lg leading-none">{emoji}</span>
    <span class="whitespace-nowrap">{label}</span>
  </a>
) : (
  <span class={`${classes} cursor-default`} aria-hidden="true">
    <span class="text-lg leading-none">{emoji}</span>
    <span class="whitespace-nowrap">{label}</span>
  </span>
)}